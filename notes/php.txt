The PHP instance to run is php/bin/php.

--------------

This build of PHP requires the environment variable PHP_HOME.

First install the pre-requisites:

apt-get install autoconf
$PHP_HOME/fix-bison 
apt-get install apache2-dev
apt-get install libxml2
apt-get install libxml2-dev
apt-get install libssl-dev
apt-get install libcurl4-openssl-dev pkg-config
apt-get install libicu-dev
apt-get install libmcrypt-dev
apt-get install libtidy-dev
# manually install libxdiff
cd /hd/temp
wget http://www.xmailserver.org/libxdiff-0.23.tar.gz
tar -xzf libxdiff-0.23.tar.gz 
cd libxdiff-0.23
./configure
make
make install
apt-get install libxslt1.1
apt-get remove libxslt1.1
apt-get install libxslt1-dev

Next build php: go to the top-level php directory and:

1. ./buildconf
2. ./current-config # it does this:
      ./configure
        --prefix=$PHP_HOME
        --enable-zend-monitor
        --with-config-file-path=$PHP_HOME/conf.d
        --with-config-file-scan-dir=$PHP_HOME/conf.d/ext
3. make -j3
4. make install

Seems to require bison 2.7, which is not available on 14.04. This
nonsense is corrected by fix-bison (run him as root!):

wget http://launchpadlibrarian.net/140087283/libbison-dev_2.7.1.dfsg-1_amd64.deb
wget http://launchpadlibrarian.net/140087282/bison_2.7.1.dfsg-1_amd64.deb
dpkg -i libbison-dev_2.7.1.dfsg-1_amd64.deb
dpkg -i bison_2.7.1.dfsg-1_amd64.deb


--------------

An extension is defined as struct zend_extension in
Zend/zend_extension.h. There are pointers to various functions for
startup, shutdown, activate, op_array_handler, etc. These are called
with:

  - dispatcher functions zend_list_apply()
  - zend_llist_apply_with_argument() 
  - zend_llist_apply_with_del()

Extensions are initialized in main/main.c:php_module_startup().

----------------

Created extension "opcode-monitor". Build with "./current-config", which
does this:

  > cd ext/opmon
  > ../../php/scripts/phpize  # may need to set it executable
  > ./current-config # it does this:
       configure 
         --enable-opcode-monitor 
         --prefix=$PHP_HOME
         --with-php-config=$PHP_HOME/bin/php-config
  > make -j3 install

-----------------

